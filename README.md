# RetroPie OSD

A lightweight on-screen display (OSD) for RetroPie that shows current time and battery percentage, similar to a phone's status bar.

![RetroPie OSD Demo](https://via.placeholder.com/800x60/000000/FFFFFF?text=10:30%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ðŸ”‹75%25)

## Features

- **Phone-like status bar**: Shows time on the left, battery on the right
- **Auto-detection**: Only displays when EmulationStation is running
- **Pi Sugar 2 Plus support**: Reads battery data via I2C
- **Lightweight**: Written in C for minimal resource usage
- **Raspberry Pi OS Lite compatible**: Works on minimal installations
- **Color-coded battery**: Green/yellow/red based on charge level
- **Auto-restart**: Systemd service ensures reliable operation

## Quick Installation

Run this single command on your Raspberry Pi:

```bash
curl -sSL https://raw.githubusercontent.com/Bob-is-stinky/retropie-osd/main/install.sh | bash
```

## Manual Installation

1. Clone the repository:
```bash
git clone https://github.com/Bob-is-stinky/retropie-osd.git
cd retropie-osd
```

2. Run the installation script:
```bash
chmod +x install.sh
./install.sh
```

## Requirements

- Raspberry Pi with Raspberry Pi OS Lite
- RetroPie with EmulationStation
- Pi Sugar 2 Plus battery HAT (optional - will show "AC" if not detected)
- X11 display server
- I2C enabled (script will enable automatically)

## Hardware Compatibility

### Tested Hardware
- Raspberry Pi 4B with Pi Sugar 2 Plus
- Raspberry Pi 3B+ with Pi Sugar 2 Plus
- Raspberry Pi Zero 2W with Pi Sugar 2 Plus

### Battery HAT Support
- **Pi Sugar 2 Plus**: Full support via I2C
- **Pi Sugar 2**: Should work (similar protocol)
- **Other battery HATs**: Will display "AC" (can be extended)

## Usage

The OSD automatically starts when your system boots and shows/hides based on EmulationStation status.

### Control Commands

```bash
# Service control
retropie-osd-control start      # Start the OSD
retropie-osd-control stop       # Stop the OSD
retropie-osd-control restart    # Restart the OSD
retropie-osd-control status     # Check service status
retropie-osd-control logs       # View logs

# System service commands
retropie-osd-control enable     # Enable auto-start on boot
retropie-osd-control disable    # Disable auto-start on boot
```

## Configuration

### Display Settings

Edit `/opt/retropie-osd/retropie-osd.c` and recompile to customize:

```c
#define UPDATE_INTERVAL 10  // Update frequency in seconds
#define BAR_HEIGHT 30       // Height of the status bar
#define TEXT_MARGIN 10      // Margin from screen edges
```

### Battery Thresholds

```c
// Battery color coding
if (battery_level > 20) {
    // Green - good battery
} else if (battery_level > 10) {
    // Yellow - low battery
} else {
    // Red - critical battery
}
```

### Recompile after changes:

```bash
cd /opt/retropie-osd
sudo make clean
sudo make
sudo make install
sudo systemctl restart retropie-osd
```

## Troubleshooting

### OSD not showing

1. Check if EmulationStation is running:
```bash
pgrep emulationstation
```

2. Check service status:
```bash
retropie-osd-control status
```

3. View logs:
```bash
retropie-osd-control logs
```

### Battery not detected

1. Check I2C is enabled:
```bash
ls /dev/i2c-*
```

2. Scan for Pi Sugar device:
```bash
i2cdetect -y 1
```
You should see device at address 0x57.

3. Check permissions:
```bash
groups $USER
```
User should be in the `i2c` group.

### Display issues

1. Check X11 is running:
```bash
echo $DISPLAY
```

2. Test X11 access:
```bash
xwininfo -root
```

3. Restart X11 if needed:
```bash
sudo systemctl restart lightdm
```

## Development

### Building from source

```bash
# Install dependencies
sudo apt-get install build-essential libx11-dev libxinerama-dev i2c-tools

# Clone and build
git clone https://github.com/YOUR_USERNAME/retropie-osd.git
cd retropie-osd
make

# Test run
./retropie-osd
```

### Project Structure

```
retropie-osd/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ retropie-osd.c      # Main program
â”œâ”€â”€ install.sh              # Installation script
â”œâ”€â”€ Makefile                # Build configuration
â”œâ”€â”€ README.md               # Documentation
â””â”€â”€ systemd/
    â””â”€â”€ retropie-osd.service # Systemd service file
```

### Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test on actual hardware
5. Submit a pull request

## Technical Details

### Architecture

- **Language**: C for performance and low resource usage
- **Display**: X11 with overlay window
- **Battery**: I2C communication with Pi Sugar 2 Plus
- **Service**: Systemd for automatic startup and monitoring
- **Detection**: Process monitoring for EmulationStation

### Performance

- **Memory usage**: ~1-2MB RAM
- **CPU usage**: <1% on Raspberry Pi 4
- **Update frequency**: 10 seconds (configurable)
- **Startup time**: <1 second

### Security

- Runs as regular user (not root)
- No network access required
- Read-only battery access
- Minimal system permissions

## License

MIT License - see LICENSE file for details.

## Changelog

### v1.0.0
- Initial release
- Pi Sugar 2 Plus support
- Auto-detection of EmulationStation
- Systemd service integration
- Color-coded battery display

## Support

- **Issues**: Report bugs on GitHub Issues
- **Discussions**: GitHub Discussions for questions
- **Hardware**: Test with your specific setup before deployment

## Credits

- Created for the RetroPie community
- Inspired by mobile phone status bars
- Tested with Pi Sugar 2 Plus hardware
